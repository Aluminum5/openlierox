#!/usr/bin/make -f
# -*- makefile -*-
#export DH_VERBOSE=1

%:
	dh $@

override_dh_auto_configure:
	cmake . -DVERSION=$(shell cat VERSION) \
		-DCMAKE_C_FLAGS="-g" \
		-DCMAKE_CXX_FLAGS="-g" \
		-DHAWKNL_BUILTIN=1 \
		-DLIBZIP_BUILTIN=1 \
		-DLIBLUA_BUILTIN=1 \
		-DBOOST_LINK_STATIC=1 \
		-DDEBUG=0 \
		-DSYSTEM_DATA_DIR=/usr/share/games
# Note: Breakpad is disabled for x86_64 because this platform is currently
# unsupported there.
ifeq ($(DEB_HOST_ARCH),amd64)
	cmake . -DBREAKPAD=Off
endif

override_dh_auto_install:
	install -d debian/tmp/usr/games/
	PREFIX=$(CURDIR)/debian/tmp \
	BIN_DIR=usr/games \
	SYSTEM_DATA_DIR=usr/share/games \
		./install.sh
	dh_auto_install
	find debian/tmp/usr/share/ \
		-type f ! -path '*scripts*' -exec chmod 644 {} \;
	find debian/tmp/usr/share/games/OpenLieroX/scripts/ \
		-type f -exec chmod 755 {} \;
